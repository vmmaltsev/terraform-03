# Домашнее задание к занятию «Управляющие конструкции в коде Terraform» - `Мальцев Виктор`

---

Задание 1

    Изучите проект.
    Заполните файл personal.auto.tfvars
    Инициализируйте проект, выполните код (он выполнится даже если доступа к preview нет).

Примечание: Если у вас не активирован preview доступ к функционалу "Группы безопасности" в Yandex Cloud - запросите доступ у поддержки облачного провайдера. Обычно его выдают в течении 24-х часов.

Приложите скриншот входящих правил "Группы безопасности" в ЛК Yandex Cloud или скриншот отказа в предоставлении доступа к preview версии.

Ответ:

![alt text](https://github.com/vmmaltsev/screenshot3/blob/main/Screenshot_79.png)

---

Задание 2

    Создайте файл count-vm.tf. Опишите в нем создание двух одинаковых ВМ web-1 и web-2(не web-0 и web-1!), с минимальными параметрами, используя мета-аргумент count loop. Назначьте ВМ созданную в 1-м задании группу безопасности.
    Создайте файл for_each-vm.tf. Опишите в нем создание 2 ВМ с именами "main" и "replica" разных по cpu/ram/disk , используя мета-аргумент for_each loop. Используйте для обеих ВМ одну, общую переменную типа list(object({ vm_name=string, cpu=number, ram=number, disk=number })). При желании внесите в переменную все возможные параметры.
    ВМ из пункта 2.2 должны создаваться после создания ВМ из пункта 2.1.
    Используйте функцию file в local переменной для считывания ключа ~/.ssh/id_rsa.pub и его последующего использования в блоке metadata, взятому из ДЗ №2.
    Инициализируйте проект, выполните код.

Ответ:

![alt text](https://github.com/vmmaltsev/screenshot3/blob/main/Screenshot_80.png)

---

Задание 3

    Создайте 3 одинаковых виртуальных диска, размером 1 Гб с помощью ресурса yandex_compute_disk и мета-аргумента count в файле disk_vm.tf .
    Создайте в том же файле одну ВМ c именем "storage" . Используйте блок dynamic secondary_disk{..} и мета-аргумент for_each для подключения созданных вами дополнительных дисков.

Ответ:

![alt text](https://github.com/vmmaltsev/screenshot3/blob/main/Screenshot_81.png)

---

Задание 4

    В файле ansible.tf создайте inventory-файл для ansible. Используйте функцию tepmplatefile и файл-шаблон для создания ansible inventory-файла из лекции. Готовый код возьмите из демонстрации к лекции demonstration2. Передайте в него в качестве переменных группы виртуальных машин из задания 2.1, 2.2 и 3.2.(т.е. 5 ВМ)
    Инвентарь должен содержать 3 группы [webservers], [databases], [storage] и быть динамическим, т.е. обработать как группу из 2-х ВМ так и 999 ВМ.
    Выполните код. Приложите скриншот получившегося файла.

Ответ:

![alt text](https://github.com/vmmaltsev/screenshot3/blob/main/Screenshot_83.png)

---

Задание 5*(необязательное)

    Напишите output, который отобразит все 5 созданных ВМ в виде списка словарей:

[
 {
  "name" = 'имя ВМ1'
  "id"   = 'идентификатор ВМ1'
  "fqdn" = 'Внутренний FQDN ВМ1'
 },
 {
  "name" = 'имя ВМ2'
  "id"   = 'идентификатор ВМ2'
  "fqdn" = 'Внутренний FQDN ВМ2'
 },
 ....
]

Приложите скриншот вывода команды terrafrom output

Ответ:

![alt text](https://github.com/vmmaltsev/screenshot3/blob/main/Screenshot_84.png)

